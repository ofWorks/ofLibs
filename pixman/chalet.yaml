name: Pixman
version: 0.0.6
externalDependencies:
  pixman:
    repository: https://gitlab.freedesktop.org/pixman/pixman.git
    # http://anongit.freedesktop.org/git/pixman.git
    tag: pixman-0.46.4
    kind: git

targets:
  pixman:
    kind: mesonProject
    location: ${external:${name}}
    install: true
    defines:
      - default_library=static
      # - buildtype=release
      - demos=disabled
      - tests=disabled
      # FIXME: only for platform RPI
    defines[architecture:!x86_64]:
      - mmx=disabled
      - sse2=disabled
    defines[platform:macos]:
      - c_args=-mmacos-version-min=10.15
      - cpp_args=-mmacos-version-min=10.15

    # FIXME: Remove when this is closed https://github.com/chalet-org/chalet/issues/425
    # defines[toolchain:{aarch64-linux-gnu-gcc,arm-linux-gnueabihf-gcc}]:
    # - prefix=${externalBuild:${name}}
    # - libdir=lib
    # - default_both_libraries=static
    # - prefer_static=true
  # pixman-script:
  #   kind: script
  #   file: pixman.sh

distribution:
  pixman:
    kind: archive
    format: zip
    include:
      - ${externalBuild:${name}}/install/opt/homebrew/include
      - ${externalBuild:${name}}/install/opt/homebrew/lib
      - ${externalBuild:${name}}/install/usr/local/include
      - ${externalBuild:${name}}/install/usr/local/lib

      - ${externalBuild:${name}}/install/lib
      - ${externalBuild:${name}}/install/include

      - ${external:${name}}/COPYING
