name: ofLibs Cairo
version: 1.18.4 #

externalDependencies:
  cairo:
    repository: https://gitlab.freedesktop.org/cairo/cairo
    # tag: 1.18.4
    commit: 2a4589266388
    kind: git
targets:
  cairo:
    kind: mesonProject
    location: ${external:${name}}
    install: true
    defines:
      - buildtype=release
      - default_library=static

      - pixman:default_library=static

      # Disable tests
      - tests=disabled

      # Disable X11 backends
      - xcb=disabled
      - xlib=disabled

      # Disable compression
      - lzo=disabled
      # zlib is required for PDF support

      # Disable font/text backends
      - dwrite=disabled
      - fontconfig=disabled
      - freetype=disabled

      #- trace=disabled ## doesnt work, not trace or dtrace

      # Disable GObject introspection and bindings
      - glib=disabled

      # Disable utilities
      - gtk2-utils=disabled
      - symbol-lookup=disabled

      # Disable image formats you don't need
      # png is required for SVG support

      # Disable additional features
      - tee=disabled
      - spectre=disabled

    defines[toolchain:{aarch64-linux-gnu-gcc,arm-linux-gnueabihf-gcc}]:
      - pixman:mmx=disabled
      - pixman:sse2=disabled
      - pixman:ssse3=disabled
      - pixman:vmx=disabled

    defines[platform:macos]:
      - c_args=-mmacos-version-min=11.6
      - cpp_args=-mmacos-version-min=11.6

    defines[:web]:
      # ADD THIS SECTION FOR EMSCRIPTEN
      - c_args=-sPTHREAD_POOL_SIZE=4
      - cpp_args=-sPTHREAD_POOL_SIZE=4
      - c_link_args=-sUSE_PTHREADS=1 -sWASM=1 -sATOMICS=1 -sBULK_MEMORY=1 -sERROR_ON_UNDEFINED_SYMBOLS=1
      - cpp_link_args=-sUSE_PTHREADS=1 -sWASM=1 -sATOMICS=1 -sBULK_MEMORY=1 -sERROR_ON_UNDEFINED_SYMBOLS=1

distribution:
  cairo:
    kind: archive
    format: zip
    include:
      # - *
      - ${external:${name}}/COPYING*
      - ${externalBuild:${name}}/install/include
      - ${externalBuild:${name}}/install/lib

    # - !${externalBuild:${name}}/install/lib/cairo
    # exclude:
    # - ${externalBuild:${name}}/install/lib/cairo
